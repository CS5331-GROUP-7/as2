from scapy.all import *
import logging

logging.getLogger("scapy.runtime").setLevel(logging.ERROR)


def packet_callback(packet):
    if packet[TCP].payload:
        if packet[IP].dport == 80:
            payload = str(bytes(packet[TCP].payload))
            # transmission of plaintext password leak
            for l in payload.split('\r\n'):
                if 'password' in l:
                    password_regex = re.compile("password=&p=(.*)")
                    pws = password_regex.findall(l)
                    if len(pws) > 0:
                        print(pws[0])
                        exit(0)
                    print l
                    exit(0)


sniff(filter="tcp", prn=packet_callback, store=0)
